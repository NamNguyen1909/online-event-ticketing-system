{% extends 'layout/base.html' %}
{% block title %}Báo Cáo Doanh Thu - EventHub{% endblock %}

{% block extra_css %}
<!-- Tailwind CSS -->
<link href="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Báo Cáo Doanh Thu</h1>
  <div class="mb-4">
    <p class="text-lg font-bold">Tổng Doanh Thu: {{ "{:,.0f} đ".format(total_revenue) }}</p>
  </div>

  {% if stats %}
  <div class="bg-white shadow rounded p-4">
    <canvas id="revenueChart" height="120"></canvas>
  </div>
  {% else %}
  <p>Không có dữ liệu doanh thu.</p>
  {% endif %}

  <a href="{{ url_for('organizer_my_events') }}" class="bg-gray-300 text-black px-4 py-2 rounded mt-4 inline-block">Quay Lại</a>
</div>

<!-- ✅ Chart.js chính chủ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>

{% if stats %}
<script>
  const chartLabels = {{ stats|map(attribute='title')|list|tojson }};
  const chartData = {{ stats|map(attribute='revenue')|list|tojson }};

  const ctx = document.getElementById('revenueChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: chartLabels,
      datasets: [{
        label: 'Doanh thu (VNĐ)',
        data: chartData,
        backgroundColor: 'rgba(54, 162, 235, 0.7)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: function(context) {
              return context.parsed.y.toLocaleString('vi-VN') + ' đ';
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return value.toLocaleString('vi-VN') + ' đ';
            }
          }
        }
      }
    }
  });
</script>
{% endif %}
{% endblock %}
