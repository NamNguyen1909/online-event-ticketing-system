{% extends 'layout/base.html' %}
{% block content %}
<div class="container mt-5 mb-5">
    <h2>Hồ sơ người dùng</h2>
    <div class="card mb-4">
        <div class="card-body">
            <div class="d-flex align-items-center mb-3">
                <img src="{{ user.avatar_url or url_for('static', filename='img/default-avatar.png') }}" alt="Avatar" class="rounded-circle me-3" width="100" height="100">
                <div>
                    <h5 class="mb-1">{{ user.username }}</h5>
                    <span class="badge bg-info">{{ user.role.value|capitalize }}</span>
                    {% if user.is_active %}
                        <span class="badge bg-success">Hoạt động</span>
                    {% else %}
                        <span class="badge bg-danger">Đã khoá</span>
                    {% endif %}
                </div>
            </div>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>Số điện thoại:</strong> {{ user.phone or 'Chưa cập nhật' }}</p>
            <p><strong>Ngày tạo tài khoản:</strong> {{ user.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
            <p><strong>Tổng chi tiêu:</strong> {{ '{:,.0f}'.format(user.total_spent or 0) }} VNĐ</p>
            <p><strong>Nhóm khách hàng:</strong> {{ user.get_customer_group().value|capitalize }}</p>
            <a href="/profile/edit" class="btn btn-primary mt-3">Chỉnh sửa hồ sơ</a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="mb-3">Lịch sử vé đã mua gần nhất</h5>
            {% if recent_tickets and recent_tickets|length > 0 %}
                <div class="table-responsive">
                    <table class="table table-bordered table-sm align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Mã vé</th>
                                <th>Sự kiện</th>
                                <th>Loại vé</th>
                                <th>Giá</th>
                                <th>Ngày mua</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ticket in recent_tickets %}
                            <tr>
                                <td>{{ ticket.id }}</td>
                                <td>{{ ticket.event.title if ticket.event else '---' }}</td>
                                <td>{{ ticket.ticket_type.name if ticket.ticket_type else '---' }}</td>
                                <td>{{ '{:,.0f}'.format(ticket.price or 0) }} VNĐ</td>
                                <td>{{ ticket.purchase_date.strftime('%d/%m/%Y %H:%M') }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <a href="/my-tickets" class="btn btn-outline-primary btn-sm">Xem tất cả vé</a>
            {% else %}
                <p>Bạn chưa mua vé nào.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
